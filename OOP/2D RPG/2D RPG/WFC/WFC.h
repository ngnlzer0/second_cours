#pragma once

#include <iostream>
#include <vector>
#include <set>
#include <queue>
#include <algorithm>
#include <stdexcept>
#include <limits>
#include<string>


struct Tile {
    int id;                                  // Унікальний ідентифікатор тайлу
    std::vector<int> compatibleWith[4];     // Сумісні тайли для кожної сторони: 0 = верх, 1 = праворуч, 2 = низ, 3 = ліворуч
};

struct Cell {
    std::set<int> possibleTiles;            // Список можливих тайлів для цієї клітинки
    bool isCollapsed = false;               // Чи відбулась колапсація?
};

class WFCMapGenerator {
private:
    int width, height;                      // Розміри карти
    std::vector<Tile> tiles;                // Список доступних тайлів
    std::vector<std::vector<Cell>> grid;    // Грати, що представляють карту
    const std::vector<std::pair<int, int>> directions = {
        {0, -1}, {1, 0}, {0, 1}, {-1, 0}    // Напрямки: верх, право, низ, ліво
    };

    void collapseCell(int x, int y);        // Колапсація клітинки
    void propagate(int x, int y);           // Пропагування змін після колапсації
    std::pair<int, int> findMinEntropyCell(); // Знайти клітинку з мінімальною ентропією

public:
    WFCMapGenerator(int w, int h, const std::vector<Tile>& availableTiles);
    void generate();                        // Генерація карти
    void printGrid() const;                 // Друк карти в консоль
};


std::vector<Tile> tiles = {
    {0, {{1, 3}, {1, 3}, {1, 3}, {1, 3}}}, // Лівий верхній край стіни
    {1, {{0, 2}, {0, 2}, {0, 2}, {0, 2}}}, // Середній верхній край стіни
    {2, {{1, 5}, {1, 5}, {1, 5}, {1, 5}}}, // Правий верхній край стіни
    {3, {{0, 4}, {0, 4}, {0, 4}, {0, 4}}}, // Лівий середній край стіни
    {4, {{0, 1, 2, 3, 5, 6, 7, 8}, {0, 1, 2, 3, 5, 6, 7, 8}, {0, 1, 2, 3, 5, 6, 7, 8}, {0, 1, 2, 3, 5, 6, 7, 8}}}, // Середній стіни
    {5, {{4, 2, 8}, {4, 2, 8}, {4, 2, 8}, {4, 2, 8}}}, // Правий середній край стіни
    {6, {{3, 7}, {3, 7}, {3, 7}, {3, 7}}}, // Лівий нижній край стіни
    {7, {{4, 6, 8}, {4, 6, 8}, {4, 6, 8}, {4, 6, 8}}}, // Середній нижній край стіни
    {8, {{5, 7}, {5, 7}, {5, 7}, {5, 7}}}, // Правий нижній край стіни
    {9, {{4, 10}, {4, 10}, {4, 10}, {4, 10}}}, // Вертикальна ліва стіна
    {10, {{4, 9}, {4, 9}, {4, 9}, {4, 9}}}, // Вертикальна права стіна
    {11, {{4}, {4}, {4}, {4}}}, // Кутова стіна із сходами вгору
    {12, {{4}, {4}, {4}, {4}}}, // Сходи вгору
    {13, {{4}, {4}, {4}, {4}}}, // Сходи вниз
    {14, {{0, 1, 2, 3, 4, 5, 6, 7, 8}, {0, 1, 2, 3, 4, 5, 6, 7, 8}, {0, 1, 2, 3, 4, 5, 6, 7, 8}, {0, 1, 2, 3, 4, 5, 6, 7, 8}}}, // Підлога
    {15, {{4}, {4}, {4}, {4}}}, // Сітка павука
    {16, {{14}, {14}, {14}, {14}}}, // Малий скриня
    {17, {{14}, {14}, {14}, {14}}}, // Велика скриня
    {18, {{14}, {14}, {14}, {14}}}, // Закрита скриня
    {19, {{14}, {14}, {14}, {14}}}, // Відкрита скриня
    {20, {{14}, {14}, {14}, {14}}}, // Щит на стіні
    {21, {{14}, {14}, {14}, {14}}}, // Ключ
    {22, {{14}, {14}, {14}, {14}}}, // Синя пляшка
    {23, {{14}, {14}, {14}, {14}}}, // Зелена пляшка
    {24, {{14}, {14}, {14}, {14}}}, // Червона пляшка
    {25, {{14}, {14}, {14}, {14}}}, // Смолоскип
    {26, {{14}, {14}, {14}, {14}}}, // Столик із лампою
    {27, {{14}, {14}, {14}, {14}}}, // Кістки на підлозі
    {28, {{14}, {14}, {14}, {14}}}, // Золотий медальйон
    {29, {{4}, {4}, {4}, {4}}}, // Замкнені ворота
    {30, {{4}, {4}, {4}, {4}}}  // Розбиті ворота
};


//WFCMapGenerator generator(20, 20, tiles);
//generator.generate();
//generator.printGrid();




